@{
    ViewData["Title"] = Localizer["Title"];
}
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer
@using SlayLib.Models

<div class="container py-4" style="max-width: 1400px;">
    <!-- Hero Section -->
    <div class="text-center mb-5">
        <h1 class="display-4 fw-bold mb-3" style="background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
            🍳 @Localizer["WelcomeTitle"]
        </h1>
        <p class="lead text-muted mb-4">@Localizer["WelcomeSubtitle"]</p>
        <div class="d-flex justify-content-center gap-3 flex-wrap">
            <a asp-controller="Recipe" asp-action="Index" class="btn btn-gradient rounded-pill px-5 py-3">
                @Localizer["BrowseRecipes"]
            </a>
            @if (User.Identity?.IsAuthenticated == true)
            {
                <a asp-controller="Recipe" asp-action="Create" class="btn btn-outline-primary rounded-pill px-5 py-3">
                    ➕ @Localizer["AddRecipe"]
                </a>
            }
            else
            {
                <a asp-area="Identity" asp-page="/Account/Register" class="btn btn-outline-primary rounded-pill px-5 py-3">
                    @Localizer["JoinUs"]
                </a>
            }
        </div>
    </div>

    <!-- Featured Recipes -->
    @{
        var featuredRecipes = ViewData["FeaturedRecipes"] as List<Recipe> ?? new List<Recipe>();
    }
    @if (featuredRecipes.Any())
    {
        <div class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold" style="background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    ⭐ @Localizer["FeaturedRecipes"]
                </h2>
                <a asp-controller="Recipe" asp-action="Index" class="btn btn-outline-primary rounded-pill">
                    @Localizer["ViewAll"] →
                </a>
            </div>
            <div class="row g-4">
                @foreach (var recipe in featuredRecipes)
                {
                    var averageRating = ViewData[$"Rating_{recipe.Id}"] as double?;
                    var ratingCount = ViewData[$"RatingCount_{recipe.Id}"] as int? ?? 0;
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 shadow-sm rounded-4 recipe-card" style="border: none; overflow: hidden;">
                            <div style="position: relative; height: 200px; overflow: hidden;">
                                <img src="@(recipe.ImageUrl ?? "https://via.placeholder.com/400x300/FF6B6B/FFFFFF?text=" + Uri.EscapeDataString(recipe.Name))"
                                     class="card-img-top" alt="@recipe.Name"
                                     style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease;" />
                            </div>
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title fw-bold">@recipe.Name</h5>
                                <p class="card-text text-muted small flex-grow-1">
                                    @(recipe.Description.Length > 100 ? recipe.Description.Substring(0, 100) + "..." : recipe.Description)
                                </p>
                                <div class="mb-2">
                                    <span class="badge rounded-pill" style="background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%); color: white;">
                                        @GetCategoryName(recipe.Category)
                                    </span>
                                    <span class="badge rounded-pill bg-secondary">⏱️ @recipe.PreparationTime @Localizer["Minutes"]</span>
                                </div>
                                @if (averageRating.HasValue)
                                {
                                    <div class="mb-2">
                                        @for (int i = 1; i <= 5; i++)
                                        {
                                            <span style="color: @(i <= averageRating.Value ? "#ffc107" : "#ddd");">⭐</span>
                                        }
                                        <small class="text-muted">(@ratingCount)</small>
                                    </div>
                                }
                                <div class="mt-auto">
                                    <a asp-controller="Recipe" asp-action="Details" asp-route-id="@recipe.Id" class="btn btn-gradient rounded-pill w-100">
                                        @Localizer["ViewDetails"]
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    }

    <!-- Categories Section -->
    <div class="mb-5">
        <h2 class="fw-bold text-center mb-4" style="background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
            📂 @Localizer["BrowseByCategory"]
        </h2>
        <div class="row g-4">
            @{
                var categories = new[]
                {
                    new { Name = "Breakfast", Icon = "🌅", Recipes = ViewData["BreakfastRecipes"] as List<Recipe> ?? new List<Recipe>(), Localized = Localizer["Category_Breakfast"].Value },
                    new { Name = "Lunch", Icon = "🍽️", Recipes = ViewData["LunchRecipes"] as List<Recipe> ?? new List<Recipe>(), Localized = Localizer["Category_Lunch"].Value },
                    new { Name = "Dinner", Icon = "🌙", Recipes = ViewData["DinnerRecipes"] as List<Recipe> ?? new List<Recipe>(), Localized = Localizer["Category_Dinner"].Value },
                    new { Name = "Dessert", Icon = "🍰", Recipes = ViewData["DessertRecipes"] as List<Recipe> ?? new List<Recipe>(), Localized = Localizer["Category_Dessert"].Value }
                };
            }
            @foreach (var category in categories)
            {
                <div class="col-md-6 col-lg-3">
                    <div class="card-modern h-100 text-center p-4">
                        <div class="mb-3" style="font-size: 3rem;">@category.Icon</div>
                        <h4 class="fw-bold mb-3">@category.Localized</h4>
                        @if (category.Recipes.Any())
                        {
                            <p class="text-muted mb-3">@Localizer["RecipesCount"]: @category.Recipes.Count</p>
                            <a asp-controller="Recipe" asp-action="Index" asp-route-category="@category.Name" class="btn btn-outline-primary rounded-pill w-100">
                                @Localizer["ViewCategory"]
                            </a>
                        }
                        else
                        {
                            <p class="text-muted mb-3">@Localizer["NoRecipesInCategory"]</p>
                        }
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Quick Links -->
    @if (User.Identity?.IsAuthenticated == true)
    {
        <div class="row g-4 mb-5">
            <div class="col-md-4">
                <div class="card-modern h-100 text-center p-4">
                    <div class="mb-3" style="font-size: 2.5rem;">❤️</div>
                    <h5 class="fw-bold mb-3">@Localizer["MyFavorites"]</h5>
                    <p class="text-muted mb-3">@Localizer["FavoritesDescription"]</p>
                    <a asp-controller="Recipe" asp-action="Favorites" class="btn btn-gradient rounded-pill w-100">
                        @Localizer["ViewFavorites"]
                    </a>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card-modern h-100 text-center p-4">
                    <div class="mb-3" style="font-size: 2.5rem;">🛒</div>
                    <h5 class="fw-bold mb-3">@Localizer["ShoppingList"]</h5>
                    <p class="text-muted mb-3">@Localizer["ShoppingListDescription"]</p>
                    <a asp-controller="ShoppingList" asp-action="Index" class="btn btn-gradient rounded-pill w-100">
                        @Localizer["ViewShoppingList"]
                    </a>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card-modern h-100 text-center p-4">
                    <div class="mb-3" style="font-size: 2.5rem;">⭐</div>
                    <h5 class="fw-bold mb-3">@Localizer["PremiumRecipes"]</h5>
                    <p class="text-muted mb-3">@Localizer["PremiumDescription"]</p>
                    <a asp-controller="Premium" asp-action="Index" class="btn btn-gradient rounded-pill w-100">
                        @Localizer["ViewPremium"]
                    </a>
                </div>
            </div>
        </div>
    }
</div>

@functions {
    string GetCategoryName(string category)
    {
        return category switch
        {
            "Breakfast" => Localizer["Category_Breakfast"].Value,
            "Lunch" => Localizer["Category_Lunch"].Value,
            "Dinner" => Localizer["Category_Dinner"].Value,
            "Dessert" => Localizer["Category_Dessert"].Value,
            "Snack" => Localizer["Category_Snack"].Value,
            _ => category
        };
    }
}

<style>
    .recipe-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .recipe-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 0.5rem 1.5rem rgba(255, 107, 53, 0.2) !important;
    }

    .recipe-card img {
        transition: transform 0.5s ease;
    }

    .recipe-card:hover img {
        transform: scale(1.1);
    }
</style>
